<template>
    <!--<slider auto-play=true
            interval=4000>
        <indicator></indicator>
    </slider>-->
    <list class="game-list" onLoadmore="loadingData" loadmoreoffset="250">

        <refresh style="width: 750; padding: 30;" onrefresh="refreshData" display="{{refreshDisplay}}">
            <text class="text"> ↓ Pull to refresh</text>
            <loading-indicator class="indicator"></loading-indicator>
        </refresh>

        <cell repeat="{{row in list}}" index="{{$index}}" class="game-row">
            <div repeat="{{item in row}}" class="game-item">
                <image class="game-image" src="{{item.game.box.large}}"></image>
                <div class="game-shadow"></div>
                <text class="game-name">{{item.game.name}}</text>
            </div>
        </cell>
    </list>
</template>

<style>
    .game-list {
        padding: 10;
    }

    .game-row {
        flex-direction: row;
    }

    .game-item {
        flex: 1;
        height: 508; /* 图片尺寸272x380，weex屏幕宽度是750，所以这里height=272/380*(750-5*2*2-10*2) */
        position: relative;
        margin: 5;
    }

    .game-image {
        flex: 1;
    }

    .game-shadow {
        background-color: #000;
        opacity: .4;
        height: 100;
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
    }

    .game-name {
        position: absolute;
        color: #fff;
        left: 30;
        right: 30;
        bottom: 20;
        font-size: 27;
        line-height: 35;
    }
</style>

<script>
    let stream = require('@weex-module/stream');
    let modal = require('@weex-module/modal');
    let viewConfig = require('./config/view-config');

    /*let games = [
     {
     "game": {
     "name": "Silent Hill 4: The Room",
     "popularity": 130265,
     "_id": 5804,
     "giantbomb_id": 6328,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/Silent%20Hill%204:%20The%20Room-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/Silent%20Hill%204:%20The%20Room-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/Silent%20Hill%204:%20The%20Room-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/Silent%20Hill%204:%20The%20Room-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/Silent%20Hill%204:%20The%20Room-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/Silent%20Hill%204:%20The%20Room-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/Silent%20Hill%204:%20The%20Room-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/Silent%20Hill%204:%20The%20Room-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 131181,
     "channels": 8
     },
     {
     "game": {
     "name": "Hearthstone: Heroes of Warcraft",
     "popularity": 65727,
     "_id": 138585,
     "giantbomb_id": 42033,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/Hearthstone:%20Heroes%20of%20Warcraft-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/Hearthstone:%20Heroes%20of%20Warcraft-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/Hearthstone:%20Heroes%20of%20Warcraft-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/Hearthstone:%20Heroes%20of%20Warcraft-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/Hearthstone:%20Heroes%20of%20Warcraft-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/Hearthstone:%20Heroes%20of%20Warcraft-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/Hearthstone:%20Heroes%20of%20Warcraft-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/Hearthstone:%20Heroes%20of%20Warcraft-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 62506,
     "channels": 182
     },
     {
     "game": {
     "name": "League of Legends",
     "popularity": 52348,
     "_id": 21779,
     "giantbomb_id": 24024,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/League%20of%20Legends-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/League%20of%20Legends-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/League%20of%20Legends-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/League%20of%20Legends-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/League%20of%20Legends-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/League%20of%20Legends-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/League%20of%20Legends-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/League%20of%20Legends-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 52479,
     "channels": 1150
     },
     {
     "game": {
     "name": "Dota 2",
     "popularity": 23483,
     "_id": 29595,
     "giantbomb_id": 32887,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/Dota%202-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/Dota%202-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/Dota%202-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/Dota%202-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/Dota%202-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/Dota%202-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/Dota%202-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/Dota%202-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 25514,
     "channels": 360
     },
     {
     "game": {
     "name": "Counter-Strike: Global Offensive",
     "popularity": 21467,
     "_id": 32399,
     "giantbomb_id": 36113,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/Counter-Strike:%20Global%20Offensive-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/Counter-Strike:%20Global%20Offensive-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/Counter-Strike:%20Global%20Offensive-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/Counter-Strike:%20Global%20Offensive-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/Counter-Strike:%20Global%20Offensive-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/Counter-Strike:%20Global%20Offensive-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/Counter-Strike:%20Global%20Offensive-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/Counter-Strike:%20Global%20Offensive-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 21552,
     "channels": 470
     },
     {
     "game": {
     "name": "Overwatch",
     "popularity": 20947,
     "_id": 488552,
     "giantbomb_id": 48190,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/Overwatch-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/Overwatch-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/Overwatch-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/Overwatch-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/Overwatch-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/Overwatch-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/Overwatch-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/Overwatch-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 20993,
     "channels": 770
     },
     {
     "game": {
     "name": "H1Z1: King of the Kill",
     "popularity": 11640,
     "_id": 417892,
     "giantbomb_id": 52692,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/H1Z1:%20King%20of%20the%20Kill-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/H1Z1:%20King%20of%20the%20Kill-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/H1Z1:%20King%20of%20the%20Kill-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/H1Z1:%20King%20of%20the%20Kill-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/H1Z1:%20King%20of%20the%20Kill-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/H1Z1:%20King%20of%20the%20Kill-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/H1Z1:%20King%20of%20the%20Kill-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/H1Z1:%20King%20of%20the%20Kill-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 11599,
     "channels": 323
     },
     {
     "game": {
     "name": "World of Warcraft",
     "popularity": 8593,
     "_id": 18122,
     "giantbomb_id": 19783,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/World%20of%20Warcraft-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/World%20of%20Warcraft-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/World%20of%20Warcraft-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/World%20of%20Warcraft-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/World%20of%20Warcraft-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/World%20of%20Warcraft-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/World%20of%20Warcraft-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/World%20of%20Warcraft-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 8675,
     "channels": 328
     },
     {
     "game": {
     "name": "Talk Shows",
     "popularity": 8007,
     "_id": 417752,
     "giantbomb_id": 0,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/Talk%20Shows-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/Talk%20Shows-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/Talk%20Shows-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/Talk%20Shows-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/Talk%20Shows-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/Talk%20Shows-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/Talk%20Shows-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/Talk%20Shows-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 8185,
     "channels": 58
     },
     {
     "game": {
     "name": "Rocket League",
     "popularity": 7643,
     "_id": 30921,
     "giantbomb_id": 34407,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/Rocket%20League-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/Rocket%20League-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/Rocket%20League-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/Rocket%20League-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/Rocket%20League-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/Rocket%20League-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/Rocket%20League-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/Rocket%20League-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 7678,
     "channels": 100
     },
     {
     "game": {
     "name": "Street Fighter V",
     "popularity": 7529,
     "_id": 488615,
     "giantbomb_id": 48320,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/Street%20Fighter%20V-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/Street%20Fighter%20V-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/Street%20Fighter%20V-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/Street%20Fighter%20V-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/Street%20Fighter%20V-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/Street%20Fighter%20V-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/Street%20Fighter%20V-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/Street%20Fighter%20V-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 7556,
     "channels": 32
     },
     {
     "game": {
     "name": "Minecraft",
     "popularity": 7117,
     "_id": 27471,
     "giantbomb_id": 30475,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/Minecraft-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/Minecraft-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/Minecraft-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/Minecraft-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/Minecraft-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/Minecraft-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/Minecraft-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/Minecraft-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 7055,
     "channels": 216
     },
     {
     "game": {
     "name": "RuneScape",
     "popularity": 6398,
     "_id": 2083,
     "giantbomb_id": 2268,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/RuneScape-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/RuneScape-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/RuneScape-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/RuneScape-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/RuneScape-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/RuneScape-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/RuneScape-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/RuneScape-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 6392,
     "channels": 89
     },
     {
     "game": {
     "name": "Destiny",
     "popularity": 5983,
     "_id": 280721,
     "giantbomb_id": 36067,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/Destiny-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/Destiny-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/Destiny-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/Destiny-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/Destiny-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/Destiny-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/Destiny-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/Destiny-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 6058,
     "channels": 881
     },
     {
     "game": {
     "name": "Creative",
     "popularity": 5512,
     "_id": 488191,
     "giantbomb_id": 0,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/Creative-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/Creative-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/Creative-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/Creative-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/Creative-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/Creative-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/Creative-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/Creative-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 5470,
     "channels": 177
     },
     {
     "game": {
     "name": "NBA 2K17",
     "popularity": 5306,
     "_id": 493112,
     "giantbomb_id": 55380,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/NBA%202K17-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/NBA%202K17-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/NBA%202K17-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/NBA%202K17-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/NBA%202K17-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/NBA%202K17-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/NBA%202K17-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/NBA%202K17-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 5125,
     "channels": 150
     },
     {
     "game": {
     "name": "Resident Evil",
     "popularity": 5063,
     "_id": 5360,
     "giantbomb_id": 27715,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/Resident%20Evil-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/Resident%20Evil-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/Resident%20Evil-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/Resident%20Evil-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/Resident%20Evil-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/Resident%20Evil-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/Resident%20Evil-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/Resident%20Evil-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 5041,
     "channels": 3
     },
     {
     "game": {
     "name": "Tattletail",
     "popularity": 4990,
     "_id": 494869,
     "giantbomb_id": 57512,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/Tattletail-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/Tattletail-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/Tattletail-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/Tattletail-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/Tattletail-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/Tattletail-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/Tattletail-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/Tattletail-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 4998,
     "channels": 1
     },
     {
     "game": {
     "name": "World of Tanks",
     "popularity": 4839,
     "_id": 27546,
     "giantbomb_id": 30567,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/World%20of%20Tanks-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/World%20of%20Tanks-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/World%20of%20Tanks-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/World%20of%20Tanks-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/World%20of%20Tanks-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/World%20of%20Tanks-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/World%20of%20Tanks-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/World%20of%20Tanks-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 4822,
     "channels": 128
     },
     {
     "game": {
     "name": "Heroes of the Storm",
     "popularity": 4145,
     "_id": 32959,
     "giantbomb_id": 36739,
     "box": {
     "large": "https://static-cdn.jtvnw.net/ttv-boxart/Heroes%20of%20the%20Storm-272x380.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-boxart/Heroes%20of%20the%20Storm-136x190.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-boxart/Heroes%20of%20the%20Storm-52x72.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-boxart/Heroes%20of%20the%20Storm-{width}x{height}.jpg"
     },
     "logo": {
     "large": "https://static-cdn.jtvnw.net/ttv-logoart/Heroes%20of%20the%20Storm-240x144.jpg",
     "medium": "https://static-cdn.jtvnw.net/ttv-logoart/Heroes%20of%20the%20Storm-120x72.jpg",
     "small": "https://static-cdn.jtvnw.net/ttv-logoart/Heroes%20of%20the%20Storm-60x36.jpg",
     "template": "https://static-cdn.jtvnw.net/ttv-logoart/Heroes%20of%20the%20Storm-{width}x{height}.jpg"
     },
     "_links": {}
     },
     "viewers": 4154,
     "channels": 106
     }
     ];*/

    const SEARCH_URL = viewConfig.SERVER + 'games?';

    module.exports = {
        data: {
            isLoaded: true,
            page: 1,
            loadingDisplay: 'hide',
            refreshDisplay: 'hide',
            loadingText: 'Loading...',
            list: []
        },
        created () {
            let url = SEARCH_URL + '&page=' + this.page;

            this.renderData(url);

            this.page++
        },
        methods: {
            renderData (url) {
                let self = this;

                stream.fetch({
                    method: 'GET',
                    url: url,
                    type: 'json'
                }, function (res) {
                    self.refreshDisplay = 'hide';
                    self.loadingDisplay = 'hide';

                    try {
                        let items = res.data['top'] || [];

                        self.appendToList(items);
                        self.isLoaded = true;
                    } catch (e) {
                        modal.toast({'message': e.message});
                    }
                }, function (res) {
                });

                modal.toast({
                    'message': '正在加载更多...',
                    'duration': 1
                });
            },
            loadingData (e) {
                let url = SEARCH_URL + '&page=' + this.page;
                let self = this;

                if (self.isLoaded === false) return;

                self.loadingDisplay = 'show';

                if (self.page <= 10) {
                    self.renderData(url);
                    self.page++
                } else {
                    self.loadingDisplay = 'hide';
                    self.loadingText = 'NO MORE!';
                }
            },
            appendToList(items) {
                let list = this.list;
                let rowCount = 2;

                for (let i = 0; i < items.length;) {
                    let lastRow = list[list.length];
                    if (!lastRow) {
                        list.$set(list.length, lastRow = []);
                    }
                    for (let j = lastRow.length; j < rowCount; j++) {
                        lastRow.$set(j, items[i]);
                        i++;
                    }
                }
            },
            loadmore () {
                console.log('load more');
            }
        }
    }
</script>
