const cookie = require('cookie');
const twitchAPI = require('../../twitch/api');
const pugRender = require('../../common/view/pug-render');
const viewIndex = require('path').join(__dirname, './view/index.pug');
const limit = 20;

module.exports = (req, res) => {
    "use strict";

    let page = req.query.page || 1;
    let game = req.query.game || '';

    twitchAPI.request(twitchAPI.apis.STREAMS, {
        game: game,
        limit: limit,
        offset: limit * Math.max(page - 1, 1)
    }, (err, json)=> {
        pugRender.render(viewIndex, {
            template: {
                title: '直播列表'
            },
            page: {
                streams: json.streams,
                game: game
            },
            err: err
        });
    });
};
