"use strict";
var cookie = require('cookie');
var twitch_access_data_1 = require('../twitch/twitch-access-data');
var logger = plug('logger');
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = function (session) {
    var _a = [session.request, session.response], req = _a[0], res = _a[1];
    var code = req.query.code;
    twitch_access_data_1.getAccessData(code, function (err, accessData) {
        if (err) {
            res.write('失败：' + JSON.stringify(err));
        }
        else {
            var cookieOpt = { maxAge: 60 * 60 * 24 * 7 };
            res.setHeader('Set-Cookie', [
                cookie.serialize('twitch_access_token', accessData['access_token'], cookieOpt),
                cookie.serialize('twitch_refresh_token', accessData['refresh_token'], cookieOpt),
                cookie.serialize('twitch_scope', accessData['scope'], cookieOpt),
            ]);
            res.write('授权成功！');
        }
        res.end();
    });
};
