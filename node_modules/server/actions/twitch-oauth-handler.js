const twitchAccessData = require('../twitch/twitch-access-data');
const cookie = require('cookie');

module.exports = function (req, res) {
    "use strict";
    let logger = plug('logger');

    let code = req.query.code;

    twitchAccessData.getAccessData(code, (err, accessData)=> {
        if (err) {
            res.write('失败：' + JSON.stringify(err));
        }
        else {
            let cookieOpt = {maxAge: 60 * 60 * 24 * 7};
            res.setHeader('Set-Cookie', [
                cookie.serialize('twitch_access_token', accessData['access_token'], cookieOpt),
                cookie.serialize('twitch_refresh_token', accessData['refresh_token'], cookieOpt),
                cookie.serialize('twitch_scope', accessData['scope'], cookieOpt),
            ]);
            //res.write('授权成功！' + JSON.stringify(accessData));
            res.write('授权成功！');
        }
        res.end();
    });
};

