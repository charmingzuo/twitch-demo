///<reference path="../global.d.ts"/>

import map from './mod-map';
let req = require;

/**
 * 注意require写在里面是为了能清除缓存
 * @param {String} modAct mod_act字符串
 * @param {IncomingMessage} req
 * @param {ServerResponse} res
 */
export const find = (modAct, req, res) => {
    let logger = plug('logger');
    let mod = map[modAct];

    if (!mod || modAct === 'default_page') {
        modAct = 'default_page';
        req.params.mod_act = modAct;
        mod = map[modAct];
    }

    if (typeof mod === 'string') {
        logger.info(`HTTP ${req.REQUEST.pathname}`);

        res.setHeader('Mod-Map', modAct + ':' + mod);
    }

    return req(mod);
};
