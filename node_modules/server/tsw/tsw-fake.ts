import {httpPort} from './tsw-config'
import modMap from './mod-map'
import {IncomingMessage} from "http"
import {ServerResponse} from "http"
import * as express from 'express'
import * as compression from 'compression'
import log from "../lib/log";

process.env.NODE_ENV = 'development';

const app = express();

app.use(compression());

Object.keys(modMap).forEach(pathname => {
    app.get('/' + pathname, function (request: IncomingMessage, response: ServerResponse) {
        let mod: Function = require(modMap[pathname]);
        log.info('mod', mod);

        if (mod instanceof Function) {
            mod({request, response});
        }
        else if (mod['default'] && mod['default'] instanceof Function) {
            mod['default']({request, response});
        }
    });
});

app.listen(httpPort);
