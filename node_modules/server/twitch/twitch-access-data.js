let request = require('request');
const messages = require('../common/messages');
const twitchConfig = './twitch-config';
const twitchOauth = require(twitchConfig).OAUTH;
const twitchAPI = require('./api');

module.exports = {

    getAccessData: (code, cb)=> {
        "use strict";

        let logger = plug('logger');

        let args = {
            client_secret: twitchOauth.CLIENT_SECRET,
            grant_type: 'authorization_code',
            redirect_uri: twitchOauth.REDIRECT_URI,
            code: code
        };

        twitchAPI.request('/oauth2/token', args, (err, json)=> {
            if (err) {
                cb(messages.ERR_TWITCH_OAUTH_FAILED, {});
            } else {
                cb(null, json);
            }
        });
    }
};