///<reference path="../global.d.ts"/>

import messages from '../common/messages'
import {OAUTH} from './twitch-config'
import OAuth2Token from '../twitch/api/OAuth2Token'

const oAuth2Token = new OAuth2Token();

export let getAccessData = (code, cb) => {

    let logger = plug('logger');

    let query = {
        client_secret: OAUTH.CLIENT_SECRET,
        grant_type: 'authorization_code',
        redirect_uri: OAUTH.REDIRECT_URI,
        code: code
    };

    oAuth2Token.request(query, (err, json) => {
        if (err) {
            cb(messages.ERR_TWITCH_OAUTH_FAILED, {});
        } else {
            cb(null, json);
        }
    });
};
